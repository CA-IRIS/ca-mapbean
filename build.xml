<?xml version="1.0"?>

<!-- ================================================== -->
<!-- MapBean build file 	                        -->
<!-- ================================================== -->
<project name="MapBean" default="jar" basedir=".">

	<!-- Give user a chance to override without editing this file
	     (and without typing -D each time he compiles it) -->
	<property file=".ant.properties"/>
	<property file="${user.home}/.ant.properties"/>
	<property file="${basedir}/default.properties"/>

	<property name="name" value="MapBean"/>
	<property name="version" value="2.0" />
	<property name="src.images.dir" value="src/images" />
	<property name="src.dir" value="src/main" />
	<property name="lib.dir" value="lib" />
	<property name="docs.dir" value="docs" />
	<property name="build.dir" value="build" />
	<property name="build.lib" value="${build.dir}/lib" />
	<property name="build.classes" value="${build.dir}/classes" />
	<property name="build.javadocs" value="${build.dir}/javadocs" />
	<property name="MapBean.dist.dir" value="${name}-${version}" />
	<property name="jar.location" value="${lib.dir}"/>
	<property name="packages" value="us.mn.state.dot.map.*" />
	<property name="manifest" value="src/etc/manifest.mf" />
	<property name="build.compiler" value="modern" />

	<!-- =============================================== -->
	<!-- Prepare the build directory                     -->
	<!-- =============================================== -->
	<target name="prepare"
		description="Creates the build directory for this project.">
		<mkdir dir="${build.dir}" />
	</target>

	<!-- ================================================ -->
	<!-- Compile the source code                          -->
	<!-- ================================================ -->
	<target name="compile"
	        description="Compiles all of the source code for this project.">
		<mkdir dir="${build.classes}"/>
		<javac srcdir="${src.dir}"
		       destdir="${build.classes}"
		       debug="on"
		       deprecation="on"
		       optimize="on">
		</javac>

		<copy todir="${build.classes}">
			<fileset dir="${src.dir}">
				<include name="**/manifest.mf" />
				<include name="**/*.properties" />
			</fileset>
		</copy>

		<copy todir="${build.classes}/images">
			<fileset dir="${src.images.dir}" />
		</copy>
	</target>

	<!-- ================================================= -->
	<!-- Create the jar archive                            -->
	<!-- ================================================= -->
	<target name="jar"
		depends="compile"
		description="Creates the jar file for this project.">
		<mkdir dir="${build.lib}"/>
		<jar jarfile="${build.lib}/${name}-${version}.jar"
		      manifest="${manifest}">
			<fileset dir="${build.classes}" includes="**/*.*"/>
		</jar>
	</target>

	<!-- ================================================= -->
	<!-- Create the API documentation                      -->
	<!-- ================================================= -->
	<target name="javadocs"
		depends="prepare"
		description="Creates the javadocs for this project.">
		<mkdir dir="${build.javadocs}"/>
		<javadoc packagenames="${packages}"
		         sourcepath="${basedir}/${src.dir}"
		         destdir="${build.javadocs}"
		         author="true"
		         version="true"
		         windowtitle="${name} API"
		         doctitle="${name}"
		         bottom="Copyright &#169; Minnesota Department of
		                 Transportation. All Rights Reserved.">
		</javadoc>
	</target>

	<!-- ================================================= -->
	<!-- Create the distribution without javadocs.         -->
	<!-- ================================================= -->
	<target name="dist-lite"
	        depends="jar"
	        description="Creates the distribution directory and copies all
	                     files except javadocs.">
		<mkdir dir="${MapBean.dist.dir}"/>
		<mkdir dir="${MapBean.dist.dir}/bin"/>
		<mkdir dir="${MapBean.dist.dir}/lib"/>
		<mkdir dir="${MapBean.dist.dir}/docs"/>
		<mkdir dir="${MapBean.dist.dir}/docs/api"/>
		<mkdir dir="${MapBean.dist.dir}/src"/>
		<copy todir="${MapBean.dist.dir}/src">
			<fileset dir="${src.dir}">
				<include name = "**/*.jar" />
			</fileset>
		</copy>
		<copy todir="${MapBean.dist.dir}/lib">
			<fileset dir="${lib.dir}" />
		</copy>
		<copy todir="${MapBean.dist.dir}/lib">
			<fileset dir="${build.lib}" />
		</copy>
<!--		<copy todir="${MapBean.dist.dir}/bin">
			<fileset dir="src/bin" />
		</copy> -->
		<copy todir="${MapBean.dist.dir}/docs">
			<fileset dir="${docs.dir}" />
		</copy>
		<copy file="README.txt" tofile="${MapBean.dist.dir}/README"/>
		<copy file="LICENSE.txt" tofile="${MapBean.dist.dir}/LICENSE"/>
	</target>

	<!-- ================================================= -->
	<!-- Create the full distribution                      -->
	<!-- ================================================= -->
	<target name="dist"
	        depends="dist-lite, javadocs"
	        description="Creates the distribution directory and copies all
	                     necessary files.">
		<copy todir="${MapBean.dist.dir}/docs/api">
			<fileset dir="${build.javadocs}" />
		</copy>
	</target>

	<!-- ================================================= -->
	<!-- Clean up generated stuff                          -->
	<!-- ================================================= -->
	<target name="clean"
		description="Deletes the build and distribution directories.">
		<delete dir="${build.dir}" />
		<delete dir="${MapBean.dist.dir}" />
	</target>
</project>
